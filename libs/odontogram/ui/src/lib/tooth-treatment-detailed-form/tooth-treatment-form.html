@let form = toothTreatmentForm();
<div
  [formGroup]="form"
  [ngClass]="
    toothTreatmentStatusToCssClass[
      form.get('status')?.value || toothTreatmentStatus.PENDING
    ]
  "
  class="treatment"
>
  <div class="treatmentCol align-items-center">
    <div
      [class.disabled]="
        form.get('type')?.value === 'implant' ||
        form.get('type')?.value === 'extraction'
      "
      [class.pointer-events-none]="form.disabled"
      [class]="form.get('status')?.value ?? 'pending'"
      class="zone-selector"
    >
      <div class="main-zones">
        @for (
          zone of [
            toothZones.TOP,
            toothZones.LEFT,
            toothZones.CENTER,
            toothZones.RIGHT,
            toothZones.BOTTOM,
          ];
          track $index
        ) {
          <div
            (click)="toggleZone(zone)"
            (keydown.enter)="toggleZone(zone)"
            [class.selected]="form.get('zones')?.value?.includes(zone)"
            [class]="zone"
            mat-ripple
            tabindex="2"
          ></div>
        }
      </div>
      <div class="lateral-raiz">
        @for (zone of [toothZones.LATERAL, toothZones.ROOT]; track $index) {
          <div
            (click)="toggleZone(zone)"
            (keydown.enter)="toggleZone(zone)"
            [class.selected]="form.get('zones')?.value?.includes(zone)"
            [class]="zone"
            mat-ripple
            tabindex="2"
          ></div>
        }
      </div>
    </div>
  </div>
  <div class="treatmentCol secondCol">
    <div class="d-flex">
      <mat-form-field>
        <mat-label>Treatment</mat-label>
        <input
          [matAutocomplete]="autoCompleteTreatment"
          formControlName="treatment"
          matInput
          placeholder="Search a treatment"
          tabindex="1"
          type="text"
        />
        <mat-autocomplete
          [displayWith]="displayTreatmentOption"
          #autoCompleteTreatment="matAutocomplete"
          class="product-search"
        >
          @for (option of treatmentSuggestions(); track $index) {
            <mat-option [value]="option">{{ option.name }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
      @if (!form.disabled) {
        <button
          (click)="deleteTreatment.emit()"
          (keydown.enter)="deleteTreatment.emit()"
          mat-icon-button
          tabindex="4"
        >
          <i class="fas fa-trash text-danger"></i>
        </button>
      }
    </div>
    <div class="treatment-info">
      <div class="d-flex column-gap-05">
        <div class="affected-teeth">
          <mat-form-field tabindex="5">
            <mat-label>Teeth</mat-label>
            <mat-select formControlName="teeth" multiple>
              @for (tooth of teeth(); track $index) {
                <mat-option
                  [disabled]="tooth.disabled"
                  [value]="tooth.number"
                  >{{ tooth.number }}</mat-option
                >
              }
            </mat-select>
          </mat-form-field>
        </div>
        <div class="groupTeeth">
          <mat-button-toggle-group
            #groupLotes="matButtonToggleGroup"
            formControlName="groupTeeth"
          >
            <mat-button-toggle [value]="true">Grouped</mat-button-toggle>
            <mat-button-toggle [value]="false">Individual</mat-button-toggle>
          </mat-button-toggle-group>
        </div>
        <div
          [class.pointer-events-none]="treatmentsForm.disabled"
          class="status"
        >
          <div
            (click)="setStatus(treatment, toothTreatmentStatus.PENDING)"
            (keydown.enter)="setStatus(treatment, toothTreatmentStatus.PENDING)"
            [class.active]="
              treatment.get('status')?.value === toothTreatmentStatus.PENDING
            "
            tabindex="2"
          >
            <i class="fas fa-square pending"></i>
            <span>Pending</span>
          </div>
          <div
            (click)="setStatus(treatment, toothTreatmentStatus.COMPLETED)"
            (keydown.enter)="
              setStatus(treatment, toothTreatmentStatus.COMPLETED)
            "
            [class.active]="
              treatment.get('status')?.value === toothTreatmentStatus.COMPLETED
            "
            tabindex="2"
          >
            <i class="fas fa-square finished"></i>
            <span>Completed</span>
          </div>
        </div>
      </div>
      <div class="notes">
        <textarea
          formControlName="additionalInformation"
          placeholder="Notes about the treatment"
        ></textarea>
      </div>
    </div>
  </div>
</div>
