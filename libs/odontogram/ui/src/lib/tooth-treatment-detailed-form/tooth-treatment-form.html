@let form = toothTreatmentForm();
<div
  [formGroup]="form"
  [ngClass]="
    toothTreatmentStatusToCssClass[
      form.get('status')?.value || toothTreatmentStatus.PENDING
    ]
  "
  class="treatment-container"
>
  <div class="treatmentCol align-items-center">
    <div
      [class.disabled]="
        form.get('type')?.value === 'implant' ||
        form.get('type')?.value === 'extraction'
      "
      [class.pointer-events-none]="form.disabled"
      [class]="form.get('status')?.value ?? 'pending'"
      class="zone-selector"
    >
      <div class="main-zones">
        @for (
          zone of [
            toothZones.TOP,
            toothZones.LEFT,
            toothZones.CENTER,
            toothZones.RIGHT,
            toothZones.BOTTOM,
          ];
          track $index
        ) {
          <div
            (click)="toggleZone(zone)"
            (keydown.enter)="toggleZone(zone)"
            [class.selected]="form.get('zones')?.value?.includes(zone)"
            [class]="zone"
            mat-ripple
            tabindex="2"
          ></div>
        }
      </div>
      <div class="lateral-root">
        @for (zone of [toothZones.LATERAL, toothZones.ROOT]; track $index) {
          <div
            (click)="toggleZone(zone)"
            (keydown.enter)="toggleZone(zone)"
            [class.selected]="form.get('zones')?.value?.includes(zone)"
            [class]="zone"
            mat-ripple
            tabindex="2"
          ></div>
        }
      </div>
    </div>
  </div>
  <div class="treatmentCol secondCol">
    <mat-form-field subscriptSizing="dynamic">
      <mat-label>Treatment</mat-label>
      <input
        [matAutocomplete]="autoCompleteTreatment"
        formControlName="treatment"
        matInput
        placeholder="Search a treatment"
        tabindex="1"
        type="text"
      />
      <mat-autocomplete
        [displayWith]="displayTreatmentOption"
        #autoCompleteTreatment="matAutocomplete"
      >
        @for (option of treatmentSuggestions(); track $index) {
          <mat-option [value]="option">{{ option.name }}</mat-option>
        }
      </mat-autocomplete>
    </mat-form-field>
    <!-- @if (!form.disabled) {
      <button
        (click)="deleteTreatment.emit()"
        (keydown.enter)="deleteTreatment.emit()"
        mat-icon-button
        tabindex="4"
      >
        <i class="fas fa-trash text-danger"></i>
      </button>
    } -->
    <div class="treatment-info">
      <div class="treatment-info__first-row">
        <div class="affected-teeth">
          <mat-form-field subscriptSizing="dynamic" tabindex="5">
            <mat-label>Teeth</mat-label>
            <mat-select formControlName="teeth" multiple>
              @for (tooth of teeth(); track $index) {
                <mat-option
                  [disabled]="tooth.disabled"
                  [value]="tooth.number"
                  >{{ tooth.number }}</mat-option
                >
              }
            </mat-select>
          </mat-form-field>
        </div>
        <div class="groupTeeth">
          <mat-button-toggle-group
            #groupLotes="matButtonToggleGroup"
            formControlName="groupTeeth"
          >
            <mat-button-toggle [value]="true">Grouped</mat-button-toggle>
            <mat-button-toggle [value]="false">Individual</mat-button-toggle>
          </mat-button-toggle-group>
        </div>
        <div [class.pointer-events-none]="form.disabled" class="status">
          <div
            (click)="setStatus(toothTreatmentStatus.PENDING)"
            (keydown.enter)="setStatus(toothTreatmentStatus.PENDING)"
            [class.active]="
              toothTreatmentForm().get('status')?.value ===
              toothTreatmentStatus.PENDING
            "
            tabindex="2"
          >
            <span class="square-icon pending"></span>
            <span>Pending</span>
          </div>
          <div
            (click)="setStatus(toothTreatmentStatus.COMPLETED)"
            (keydown.enter)="setStatus(toothTreatmentStatus.COMPLETED)"
            [class.active]="
              toothTreatmentForm().get('status')?.value ===
              toothTreatmentStatus.COMPLETED
            "
            tabindex="2"
          >
            <span class="square-icon finished"></span>
            <span>Completed</span>
          </div>
        </div>
      </div>
      <div class="treatment-info__notes">
        <mat-form-field subscriptSizing="dynamic">
          <mat-label>Additional information</mat-label>
          <textarea
            formControlName="additionalInformation"
            matInput
            placeholder="Notes about the treatment"
          ></textarea>
        </mat-form-field>
      </div>
    </div>
  </div>
</div>
